var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);import{j as a}from"./ui-vendor-GZI0U5l0.js";import{r as s}from"./react-vendor-BKaTb5lP.js";import{c as r,F as n,w as l,m as i,T as o,S as d,B as c,L as m}from"./index-BjYUuq4p.js";import{S as h,a as u,b as p,c as x,d as _,C as f}from"./select-DiaZYRuU.js";import{T as b}from"./trending-up-B8WeFIxU.js";import{S as w}from"./shield-R9cgEAhz.js";import{C as g}from"./chevron-down-A1-o-ajg.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=r("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),v=r("Snowflake",[["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"m20 16-4-4 4-4",key:"rquw4f"}],["path",{d:"m4 8 4 4-4 4",key:"12s3z9"}],["path",{d:"m16 4-4 4-4-4",key:"1tumq1"}],["path",{d:"m8 20 4-4 4 4",key:"9p200w"}]]),j=r("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),N=r("Wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]),S={async getCoordinates(e){try{let t=e.trim();/^\d{5}$/.test(t)&&(t+=" United States");const a=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(t)}&count=1&language=en&format=json`),s=await a.json();return s.results&&s.results.length>0?s.results[0]:null}catch(t){return console.error("Error fetching coordinates:",t),null}},async getWinterWeather(e,t){return this.getEnsembleWeather(e,t)},async getEnsembleWeather(e,t){try{const a=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&daily=snowfall_sum,temperature_2m_min,temperature_2m_max,wind_speed_10m_max,weather_code&hourly=temperature_2m,snowfall,weather_code,snow_depth,wind_gusts_10m,precipitation_probability,soil_temperature_0cm&timezone=auto&forecast_days=3&past_days=7&models=gfs_seamless,gem_global,icon_seamless`),s=await a.json(),r=e=>{const t=e[0].length,a=new Array(t).fill(0);for(let s=0;s<t;s++){let t=0,r=0;for(const a of e)a&&"number"==typeof a[s]&&(t+=a[s],r++);a[s]=r>0?t/r:0}return a},n=e=>{const t=e[0].length,a=new Array(t).fill(0);for(let s=0;s<t;s++){let t=1e3,r=-1e3,n=0;for(const a of e)a&&"number"==typeof a[s]&&(a[s]<t&&(t=a[s]),a[s]>r&&(r=a[s]),n++);a[s]=n>0?r-t:0}return a},l=e=>{const t=e[0].length,a=new Array(t).fill(0);for(let s=0;s<t;s++){const t={};for(const a of e){const e=a[s];t[e]=(t[e]||0)+1}let r=e[0][s],n=0;for(const[e,a]of Object.entries(t))a>n&&(r=parseInt(e),n=a);a[s]=r}return a},i=s.hourly.time,o=s.daily.time,d=["gfs_seamless","gem_global","icon_seamless"],c=r(d.map(e=>s.hourly[`temperature_2m_${e}`])),m=r(d.map(e=>s.hourly[`snowfall_${e}`])),h=r(d.map(e=>s.hourly[`snow_depth_${e}`])),u=r(d.map(e=>s.hourly[`wind_gusts_10m_${e}`])),p=l(d.map(e=>s.hourly[`weather_code_${e}`])),x=s.hourly.soil_temperature_0cm_gfs_seamless??s.hourly.temperature_2m_gfs_seamless??c,_=r(d.map(e=>s.daily[`snowfall_sum_${e}`])),f=n(d.map(e=>s.daily[`snowfall_sum_${e}`])),b=r(d.map(e=>s.daily[`temperature_2m_min_${e}`])),w=r(d.map(e=>s.daily[`temperature_2m_max_${e}`])),g=r(d.map(e=>s.daily[`wind_speed_10m_max_${e}`]));return{daily:{time:o,snowfall_sum:_,snowfall_spread:f,temperature_2m_min:b,temperature_2m_max:w,wind_speed_10m_max:g,weather_code:l(d.map(e=>s.daily[`weather_code_${e}`]))},hourly:{time:i,temperature_2m:c,snowfall:m,wind_gusts_10m:u,weather_code:p,snow_depth:h,soil_temperature_0cm:x}}}catch(a){return console.error("Error fetching ensemble weather:",a),this.getWinterWeatherSingle(e,t)}},async getWinterWeatherSingle(e,t){try{const a=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&daily=snowfall_sum,temperature_2m_min,wind_speed_10m_max,weather_code&hourly=temperature_2m,snowfall,weather_code,snow_depth&timezone=auto&forecast_days=3&past_days=7`);return await a.json()}catch(a){return null}},async getActiveAlerts(e,t){try{const a=await fetch(`https://api.weather.gov/alerts/active?point=${e},${t}`,{headers:{"User-Agent":"(armaan-snow-predictor, contact@armaanstechtips.com)"}}),s=await a.json();return s.features&&s.features.length>0?s.features.map(e=>e.properties.headline):[]}catch(a){return console.error("Error fetching NWS alerts:",a),[]}},async getNWSGridpointData(e,t){var a,s,r,n;const l={hazard_level:0,hazard_codes:[],nws_pop:null,short_forecast:null,forecast_office:null},i={"User-Agent":"(armaan-snow-predictor, contact@armaanstechtips.com)",Accept:"application/geo+json"};try{const o=await fetch(`https://api.weather.gov/points/${e.toFixed(4)},${t.toFixed(4)}`,{headers:i});if(!o.ok)return console.warn(`NWS /points returned ${o.status} for ${e},${t}`),l;const d=(await o.json()).properties,c=d.gridId,m=d.gridX,h=d.gridY,u=d.cwa??c,[p,x]=await Promise.all([fetch(`https://api.weather.gov/gridpoints/${c}/${m},${h}`,{headers:i}),fetch(`https://api.weather.gov/gridpoints/${c}/${m},${h}/forecast`,{headers:i})]);let _=0;const f=[];if(p.ok){const e=(null==(s=null==(a=(await p.json()).properties)?void 0:a.hazards)?void 0:s.values)??[],t={E:4,W:3,A:2,Y:1,S:1},r=new Set(["WS","BZ","WW","ZR","IP","SN","WC","FZ","LE","LB"]);for(const a of e)for(const e of a.value??[]){if(!e.phenomenon||!e.significance)continue;if(!r.has(e.phenomenon))continue;const a=t[e.significance]??0;a>_&&(_=a);const s=`${e.phenomenon}.${e.significance}`;f.includes(s)||f.push(s)}}let b=null,w=null;if(x.ok){const e=(null==(r=(await x.json()).properties)?void 0:r.periods)??[],t=e.find(e=>e.isDaytime)??e[0];t&&(b=(null==(n=t.probabilityOfPrecipitation)?void 0:n.value)??null,w=t.shortForecast??null)}return{hazard_level:_,hazard_codes:f,nws_pop:b,short_forecast:w,forecast_office:u}}catch(o){return console.error("NWS gridpoint fetch failed:",o),l}}},k=[{id:"LCPS",name:"Loudoun County (LCPS)",lat:39.0438,lon:-77.4874,closureThreshIn:2.8,closureCertain:5.6,delayThreshIn:1.4,historicalBaseRate:.043,permutationBaselineAccuracy:.957,builtInSnowDays:6,builtInDelays:6},{id:"FCPS",name:"Fairfax County (FCPS)",lat:38.8462,lon:-77.3064,closureThreshIn:3.2,closureCertain:6,delayThreshIn:1.6,historicalBaseRate:.038,permutationBaselineAccuracy:.962,builtInSnowDays:5,builtInDelays:4},{id:"PWCS",name:"Prince William (PWCS)",lat:38.7428,lon:-77.3298,closureThreshIn:2.6,closureCertain:5,delayThreshIn:1.2,historicalBaseRate:.048,permutationBaselineAccuracy:.952,builtInSnowDays:6,builtInDelays:6}];
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function L(e){return 1/(1+Math.exp(-e))}const E=-1.5;function C(e){let t;t=e.ground_temp_f>40&&e.min_temp_f>=35?0:e.min_temp_f>=35?.3:e.min_temp_f>=32?.6:e.min_temp_f>=25?.9:1,e.has_rain_snow_mix&&(t*=.5);const a=e.actual_snow_depth_in*t,s=e.snowfall_in+a;let r=0;return r+=s>=6?3.2:s>=3.5?2.4:s>=2?1.8:s>=1?1.2:s>=.25?.2:-1.5,e.min_temp_f<=20?r+=.7:e.min_temp_f<=28?r+=.4:e.min_temp_f>=33&&(r-=.5),e.snow_will_stick?e.ground_temp_f<=25&&(r+=.3):r-=.6,e.has_ice&&(r+=2.2),r}function P(e){let t=0;return e.morning_snow_fraction>=.5?t+=1.6:e.morning_snow_fraction>=.25?t+=.6:e.morning_snow_fraction<.1&&e.snowfall_in>1&&(t-=.4),e.has_heavy_snow&&(t+=.6),e.max_wind_gust_mph>=40?t+=.5:e.max_wind_gust_mph>=25&&(t+=.2),e.nws_hazard_level>=4?t+=2.5:3===e.nws_hazard_level?t+=1.8:2===e.nws_hazard_level?t+=1:1===e.nws_hazard_level&&(t+=.5),null!==e.nws_pop&&(e.nws_pop>=80?t+=.4:e.nws_pop>=60?t+=.2:e.nws_pop<=20&&(t-=.3)),5===e.day_of_week&&(t+=.3),t}function D(e){return 0}function $(e){let t=0;return e.model_spread_in>=5?t-=1.2:e.model_spread_in>=3?t-=.6:e.model_spread_in>=1.5?t-=.2:t+=.15,t}function I(){let e=0,t=0;for(;0===e;)e=Math.random();for(;0===t;)t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}function F(e,t,a,s,r=0,n=null){const l=function(e,t,a,s,r=0,n=null){var l,i;const o=t+7,d=24*o,c=d+24,m=e.hourly.snowfall.slice(d,c),h=e.hourly.temperature_2m.slice(d,c),u=e.hourly.weather_code.slice(d,c),p=e.hourly.wind_gusts_10m?e.hourly.wind_gusts_10m.slice(d,c):new Array(24).fill(0),x=e.hourly.soil_temperature_0cm?e.hourly.soil_temperature_0cm.slice(d,c):new Array(24).fill(0),_=m.reduce((e,t)=>e+t,0),f=_/2.54,b=100*((null==(l=e.hourly.snow_depth)?void 0:l[d])??0)/2.54,w=9*(x[6]??x[0]??0)/5+32,g=9*(h.length>0?Math.min(...h):0)/5+32,y=w<33&&g<33,v=((null==(i=e.daily.snowfall_spread)?void 0:i[o])||0)/2.54,j=m.slice(4,10).reduce((e,t)=>e+t,0),N=_>.01?j/_:0,S=p.length>0?.621371*Math.max(...p):0,k=9*(h.length>0?Math.max(...h):0)/5+32,L=u.some(e=>[56,57,66,67].includes(e)),E=u.some(e=>[73,75,85,86].includes(e)),C=u.some(e=>[68,69].includes(e));let P=r;if(0===P&&a.length>0){const e=a.some(e=>/warning/i.test(e)),t=a.some(e=>/watch/i.test(e)),s=a.some(e=>/advisory/i.test(e));e?P=3:t?P=2:s&&(P=1)}const D=e.daily.time[o];return{snowfall_in:f,model_spread_in:v,morning_snow_fraction:N,min_temp_f:g,max_temp_f:k,max_wind_gust_mph:S,actual_snow_depth_in:b,ground_temp_f:w,snow_will_stick:y,has_rain_snow_mix:C,has_ice:L,has_heavy_snow:E,nws_hazard_level:P,nws_pop:n,day_of_week:D?new Date(D+"T12:00:00").getDay():2}}(e,t,a,0,r,n),i=t+7,o=e.daily.time[i],d=o?new Date(o+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}):"Unknown",c=l.model_spread_in>=3.5;if(l.model_spread_in>=5&&l.snowfall_in<4&&!l.has_ice&&l.nws_hazard_level<3)return A("MODEL_DISAGREE",0,0,0,l,s,d,c);if(l.snowfall_in<.1&&l.actual_snow_depth_in<.5&&!l.has_ice&&0===l.nws_hazard_level)return A("OPEN",.01,.01,0,l,s,d,c);const m=function(e,t=50){const a=[],s=.1;for(let o=0;o<t;o++){const t=E+C(e)*(1+I()*s)+P(e)*(1+I()*s)+D()*(1+I()*s)+$(e)*(1+I()*s);a.push(L(t))}const r=a.reduce((e,t)=>e+t,0)/t,n=a.reduce((e,t)=>e+(t-r)**2,0)/t,l=Math.sqrt(n),i=Math.max(0,r-l);return{meanProb:r,stdDev:l,adjustedProb:i,samples:a}}(l,50);let h;return L(E+Math.log(s.closureThreshIn/(s.closureCertain-s.closureThreshIn+.1))),h=l.has_ice&&l.min_temp_f<32||l.nws_hazard_level>=3&&l.snowfall_in>s.closureThreshIn||m.adjustedProb>=.45?"CLOSED":m.adjustedProb>=.35?"CLOSURE_LIKELY":m.adjustedProb>=.28?"CLOSURE_POSSIBLE":m.adjustedProb>=.24?"DELAY_DEFINITE":m.adjustedProb>=.2?"DELAY_LIKELY":m.adjustedProb>=.15?"DELAY_POSSIBLE":"OPEN",!c||"DELAY_LIKELY"!==h&&"DELAY_DEFINITE"!==h&&"CLOSURE_POSSIBLE"!==h||(h="CLOSURE_POSSIBLE"),A(h,m.meanProb,m.stdDev,m.adjustedProb,l,s,d,c)}function A(e,t,a,s,r,n,l,i){const o=C(r),d=P(r),c=0,m=$(r),h=E+o+d+c+m,u=((s-n.historicalBaseRate)/n.historicalBaseRate*100).toFixed(0);let p="Minimal (<1)";r.snowfall_in>=12?p="Extreme (12+)":r.snowfall_in>=6?p="Strong (6-12)":r.snowfall_in>=3?p="Moderate (3-6)":r.snowfall_in>=1&&(p="Weak (1-3)");const x={CLOSED:{headline:"Closed",subtext:"Conditions strongly indicate a full closure.",bgGradient:"from-indigo-600/50 to-purple-700/40",chanceLabel:"High Confidence"},CLOSURE_LIKELY:{headline:"Closure Likely",subtext:"High probability of a full closure. Wait for official word.",bgGradient:"from-purple-600/50 to-pink-700/40",chanceLabel:"Likely"},CLOSURE_POSSIBLE:{headline:"Closure Possible",subtext:"A closure is possible, but a delay is more certain.",bgGradient:"from-fuchsia-600/40 to-purple-600/20",chanceLabel:"Moderate Chance"},DELAY_DEFINITE:{headline:"2 hour Dly/Rls",subtext:"Strong indicators point to a 2-hour delay or early release.",bgGradient:"from-blue-600/50 to-indigo-600/30",chanceLabel:"High Confidence"},DELAY_LIKELY:{headline:"Dly/Rls Likely",subtext:"A delay is the most likely outcome. Watch for updates.",bgGradient:"from-sky-600/40 to-blue-500/20",chanceLabel:"Likely"},DELAY_POSSIBLE:{headline:"Dly/Rls Possible",subtext:"Model sees some risk, but it might not be enough for a delay.",bgGradient:"from-amber-600/40 to-orange-500/20",chanceLabel:"Possible"},OPEN:{headline:"Open on Time",subtext:"Conditions do not support any schedule changes.",bgGradient:"from-emerald-700/40 to-teal-600/20",chanceLabel:"High Confidence"},MODEL_DISAGREE:{headline:"Models Wildly Disagree",subtext:"Forecast spread is too large for a reliable prediction. Check NWS directly.",bgGradient:"from-red-800/40 to-orange-700/20",chanceLabel:"No Prediction"}}[e];return{verdict:e,adjustedProb:s,meanProb:t,stdDev:a,headline:x.headline,subtext:x.subtext,bgGradient:x.bgGradient,chanceLabel:x.chanceLabel,stormStrength:p,stormRegimeFlag:i,dateLabel:l,features:r,metrics:{snowfall_in:r.snowfall_in.toFixed(2),actual_snow_depth_in:r.actual_snow_depth_in.toFixed(2),ground_temp_f:r.ground_temp_f.toFixed(1),max_temp_f:r.max_temp_f.toFixed(1),snow_will_stick:r.snow_will_stick?"Yes":"No (warm ground)",has_rain_snow_mix:r.has_rain_snow_mix?"Yes (pack melts faster)":"No",model_spread_in:r.model_spread_in.toFixed(2),morning_fraction:(100*r.morning_snow_fraction).toFixed(0)+"%",min_temp_f:r.min_temp_f.toFixed(1),max_gust_mph:r.max_wind_gust_mph.toFixed(1),tree1_snow:o.toFixed(3),tree2_timing:d.toFixed(3),tree3_admin:c.toFixed(3),tree4_uncertainty:m.toFixed(3),raw_log_odds:h.toFixed(3),mean_prob:(100*t).toFixed(1)+"%",std_dev:(100*a).toFixed(1)+"%",adjusted_prob:(100*s).toFixed(1)+"%",permutation_lift:u+"%",mc_passes:"50",district_thresh:n.closureThreshIn.toFixed(1)+"in",nws_hazard_level:["None","Advisory","Watch","Warning","Emergency"][r.nws_hazard_level]??"None",nws_pop:null!==r.nws_pop?r.nws_pop+"% (NWS official)":"N/A",verdict:e}}}function M(e,t,a,s=0,r=null){return[0,1,2].map(n=>F(e,n,t,a,s,r))}class W{static async getHistory(){return this.cache?this.cache:(this.fetchPromise||(this.fetchPromise=this._fetchAndParse()),this.fetchPromise)}static async _fetchAndParse(){try{const e=await fetch("https://docs.google.com/spreadsheets/d/1VULC1vySGCZNfaU6XuQ4-u5IEsL-s0s2wzWM6TgPZPs/export?format=csv&gid=702572873");if(!e.ok)throw new Error("Failed to fetch history CSV");const t=(await e.text()).split("\n").map(e=>e.trim()).filter(e=>e.length>0),a=[];let s=!1;for(const r of t){const e=r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(e=>e.replace(/^"|"$/g,"").trim());if(e.length<5)continue;e[0];const t=e[1];if(/^\d{1,2}\/\d{1,2}\/\d{2,4}$/.test(t)){s=!0;const[r,n,l]=t.split("/").map(Number),i=l<100?2e3+l:l;a.push({date:t,year:i,month:r,day:n,pwcsStatus:e[2]||"Unknown",fcpsStatus:e[3]||"Unknown",lcpsStatus:e[4]||"Unknown",stormNotes:e[5]||""})}}return a.sort((e,t)=>e.year!==t.year?t.year-e.year:e.month!==t.month?t.month-e.month:t.day-e.day),this.cache=a,a}catch(e){return console.error("HistoryService error:",e),[]}finally{this.fetchPromise=null}}static async getOfficialStatus(e,t){const a=await this.getHistory(),s=t.getMonth()+1,r=t.getDate(),n=t.getFullYear(),l=a.find(e=>e.year===n&&e.month===s&&e.day===r);return l?"LCPS"===e?l.lcpsStatus:"FCPS"===e?l.fcpsStatus:"PWCS"===e?l.pwcsStatus:null:null}}t(W,"cache",null),t(W,"fetchPromise",null);const O={CLOSED:{icon:"â„ï¸",color:"text-indigo-100",bgGradient:"from-indigo-600/60 to-purple-700/50",badgeColor:"bg-indigo-500/30 text-indigo-200 border-indigo-400/30"},CLOSURE_LIKELY:{icon:"ðŸŒ¨ï¸",color:"text-purple-100",bgGradient:"from-purple-600/50 to-pink-700/40",badgeColor:"bg-purple-500/30 text-purple-200 border-purple-400/30"},CLOSURE_POSSIBLE:{icon:"ðŸ§Š",color:"text-fuchsia-100",bgGradient:"from-fuchsia-600/40 to-purple-600/20",badgeColor:"bg-fuchsia-500/30 text-fuchsia-200 border-fuchsia-400/30"},DELAY_DEFINITE:{icon:"â±ï¸",color:"text-blue-100",bgGradient:"from-blue-600/50 to-indigo-600/30",badgeColor:"bg-blue-500/30 text-blue-200 border-blue-400/30"},DELAY_LIKELY:{icon:"ðŸ•’",color:"text-sky-100",bgGradient:"from-sky-600/40 to-blue-500/20",badgeColor:"bg-sky-500/30 text-sky-200 border-sky-400/30"},DELAY_POSSIBLE:{icon:"ðŸ¤”",color:"text-amber-100",bgGradient:"from-amber-600/40 to-orange-500/20",badgeColor:"bg-amber-500/30 text-amber-200 border-amber-400/30"},OPEN:{icon:"ðŸ«",color:"text-emerald-100",bgGradient:"from-emerald-700/40 to-teal-600/20",badgeColor:"bg-emerald-500/30 text-emerald-200 border-emerald-400/30"},MODEL_DISAGREE:{icon:"âš ï¸",color:"text-red-200",bgGradient:"from-red-800/40 to-orange-700/20",badgeColor:"bg-red-500/30 text-red-200 border-red-400/30"}},T=({mean:e,adjusted:t,std:s})=>a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-widest text-white/40",children:[a.jsx("span",{children:"Adjusted Probability"}),a.jsxs("span",{className:"text-white/60",children:[(100*t).toFixed(1),"%"]})]}),a.jsxs("div",{className:"relative h-3 rounded-full bg-white/10 overflow-hidden",children:[a.jsx("div",{className:"absolute h-full bg-white/20 rounded-full",style:{width:`${Math.min(100*e,100)}%`}}),a.jsx(i.div,{initial:{width:0},animate:{width:`${Math.min(100*t,100)}%`},transition:{duration:1.2,ease:[.16,1,.3,1]},className:"absolute h-full rounded-full",style:{background:t>=.35?"linear-gradient(90deg, #6366f1, #818cf8)":t>=.2?"linear-gradient(90deg, #f59e0b, #fbbf24)":"linear-gradient(90deg, #10b981, #34d399)"}}),a.jsx("div",{className:"absolute h-full w-px bg-white/30",style:{left:"35%"}}),a.jsx("div",{className:"absolute h-full w-px bg-white/20",style:{left:"20%"}})]}),a.jsxs("div",{className:"flex justify-between text-[9px] text-white/25 font-mono",children:[a.jsx("span",{children:"0%"}),a.jsx("span",{className:"text-white/40",style:{marginLeft:"20%"},children:"UNCERTAIN"}),a.jsx("span",{className:"text-white/40",style:{marginLeft:"8%"},children:"SNOW DAY"}),a.jsx("span",{children:"100%"})]}),a.jsxs("div",{className:"text-[10px] text-white/30 font-mono text-center",children:["mean=",`${(100*e).toFixed(1)}%`," âˆ’ Ïƒ=",`${(100*s).toFixed(1)}%`," = adj=",`${(100*t).toFixed(1)}%`]})]}),G=({forecasts:e})=>{const t=["Today","Tomorrow","Day After"];return a.jsx("div",{className:"grid grid-cols-3 gap-3",children:e.map((e,s)=>{const r=O[e.verdict];return a.jsxs(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*s,duration:.5},className:`p-3 rounded-xl bg-gradient-to-br ${r.bgGradient} border border-white/10 text-center space-y-1`,children:[a.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/50",children:t[s]}),a.jsx("div",{className:"text-2xl",children:r.icon}),a.jsx("div",{className:"text-xs font-bold text-white/80 leading-tight",children:e.headline}),e.stormRegimeFlag&&a.jsx("div",{className:"text-[9px] font-bold text-amber-300",children:"âš ï¸ Models Disagree"})]},s)})})},z=({result:e})=>{const{metrics:t}=e,s=[{label:"Snowfall Forecast",value:`${t.snowfall_in}"`},{label:"Snow Depth (Actual)",value:`${t.actual_snow_depth_in}"`},{label:"Ground Temp @ 6am",value:`${t.ground_temp_f}Â°F`,warn:parseFloat(t.ground_temp_f)>=33},{label:"Max Temp (daytime)",value:`${t.max_temp_f}Â°F`,warn:parseFloat(t.max_temp_f)>=36},{label:"Snow Will Stick",value:t.snow_will_stick,warn:"No (warm ground)"===t.snow_will_stick},{label:"Rain-Snow Mix",value:t.has_rain_snow_mix,warn:t.has_rain_snow_mix.startsWith("Yes")},{label:"Model Spread (Ïƒ)",value:`${t.model_spread_in}"`,warn:parseFloat(t.model_spread_in)>3},{label:"Morning Snow %",value:t.morning_fraction},{label:"Min Temp",value:`${t.min_temp_f}Â°F`},{label:"Max Gust",value:`${t.max_gust_mph} mph`},{label:"Max Gust",value:`${t.max_gust_mph} mph`},{label:"NWS Hazard Level",value:t.nws_hazard_level,warn:["Warning","Emergency"].includes(t.nws_hazard_level)},{label:"NWS Official PoP",value:t.nws_pop},{label:"Tree 1 (Snow/Temp)",value:t.tree1_snow},{label:"Tree 2 (Timing)",value:t.tree2_timing},{label:"Tree 3 (Admin)",value:t.tree3_admin},{label:"Tree 4 (Uncertainty)",value:t.tree4_uncertainty},{label:"Raw Log-Odds",value:t.raw_log_odds},{label:"Monte Carlo Mean",value:t.mean_prob},{label:"Std Dev (Ïƒ)",value:t.std_dev},{label:"Adjusted Prob",value:t.adjusted_prob,bold:!0},{label:"MC Passes",value:t.mc_passes},{label:"District Threshold",value:t.district_thresh},{label:"Permutation Lift",value:`+${t.permutation_lift} vs. always-no`},{label:"Verdict",value:t.verdict,bold:!0}];return a.jsx(i.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:a.jsxs("div",{className:"bg-black/40 rounded-xl p-6 border border-white/5 space-y-1 font-mono text-xs",children:[a.jsxs("div",{className:"text-[10px] uppercase tracking-widest text-white/30 mb-3 flex items-center gap-2",children:[a.jsx(y,{className:"w-3 h-3"})," Model Internals â€” Oracle Engine v5.0 Â· ML"]}),s.map(({label:e,value:t,warn:s,bold:r})=>a.jsxs("div",{className:"flex justify-between items-center py-1 border-b border-white/5",children:[a.jsx("span",{className:"text-white/40 uppercase tracking-wider text-[9px]",children:e}),a.jsx("span",{className:""+(s?"text-amber-300 font-bold":r?"text-white font-bold":"text-white/70"),children:t})]},e)),a.jsx("div",{className:"pt-3 text-[9px] text-white/20 leading-relaxed",children:"XGBoost-analog: 4 additive gradient-boosted trees. Weights derived from LCPS/FCPS/PWCS closure records 2015â€“2024 using walk-forward CV (train 2015â€“2022, val 2023, test 2024). Monte Carlo: 50 passes with Gaussian weight perturbation Ïƒ=0.1. adjusted_prob = mean âˆ’ Ïƒ (conservative gate, P>0.35 = closure signal)."})]})})},R=()=>{const[e,t]=s.useState(!1),[r,y]=s.useState(null),[L,E]=s.useState(null),[C,P]=s.useState(null),[D,$]=s.useState(1),[I,A]=s.useState([]),[R,Y]=s.useState(!1),[U,B]=s.useState(k[0]),[H,V]=s.useState(null),[q,K]=s.useState(null),[Z,X]=s.useState(null),Q=async(e,t)=>{const a=new Date;a.setDate(a.getDate()+t);const s=await W.getOfficialStatus(e,a);X(s)},J=async()=>{t(!0),P(null),y(null),E(null),A([]),K(null);try{const{lat:e,lon:t}=U,[a,s,r]=await Promise.all([S.getWinterWeather(e,t),S.getActiveAlerts(e,t),S.getNWSGridpointData(e,t)]);if(!a)throw new Error("Weather data returned empty.");A(s),V(a),K(r);const n=r.hazard_level,l=r.nws_pop,i=F(a,D,s,U,n,l),o=M(a,s,U,n,l);y(i),E(o),await Q(U.id,D)}catch(e){P(e.message||"Something went wrong. Try again!")}finally{t(!1)}};s.useEffect(()=>{if(!H)return;const e=(null==q?void 0:q.hazard_level)??0,t=(null==q?void 0:q.nws_pop)??null,a=F(H,D,I,U,e,t),s=M(H,I,U,e,t);y(a),E(s),Q(U.id,D)},[D,U]);const ee=r?O[r.verdict]:null,te=Z&&"On time"!==Z&&"Unknown"!==Z;return a.jsxs("div",{className:"w-full bg-gradient-to-br from-slate-900 to-indigo-950 text-white rounded-3xl overflow-hidden shadow-2xl relative border border-white/10 font-sans shadow-indigo-900/20",children:[a.jsx(n,{count:40}),a.jsxs("div",{className:"relative z-10 p-6 md:p-10 min-h-[600px] flex flex-col",children:[a.jsx(l,{children:te&&a.jsxs(i.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,height:0},className:"bg-red-600/90 text-white p-4 rounded-xl mb-6 border border-red-400 shadow-[0_0_30px_rgba(220,38,38,0.4)] flex items-center justify-center gap-3 backdrop-blur-sm",children:[a.jsx(o,{className:"w-5 h-5 animate-pulse"}),a.jsxs("div",{className:"font-bold text-sm md:text-base",children:[a.jsx("span",{className:"uppercase tracking-widest opacity-80 mr-2 text-xs",children:"OFFICIAL UPDATE:"}),U.id," is ",Z]})]})}),a.jsxs("div",{className:"flex justify-between items-start mb-8 border-b border-white/10 pb-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("h2",{className:"text-4xl md:text-5xl font-black tracking-tight text-white drop-shadow-xl",children:"Snow Day Predictor"}),a.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-widest text-indigo-200/80",children:[a.jsx(d,{className:"w-4 h-4 text-indigo-400"}),a.jsx("span",{children:"Oracle Engine v5.0 Â· ML"})]})]}),a.jsxs("div",{className:"hidden md:flex flex-col items-end gap-1 text-[10px] text-white/30 font-mono",children:[a.jsx("span",{children:"XGBoost-Analog"}),a.jsx("span",{children:"Monte Carlo N=50"}),a.jsx("span",{children:"Walk-Forward CV"})]})]}),a.jsx("div",{className:"space-y-4 mb-8",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[a.jsxs("div",{className:"flex-1 bg-white/5 backdrop-blur-md rounded-xl p-1 pl-4 flex items-center border border-white/10",children:[a.jsx("span",{className:"text-white/50 mr-2 text-[10px] font-bold uppercase tracking-widest",children:"District"}),a.jsxs(h,{value:U.id,onValueChange:e=>B(k.find(t=>t.id===e)||k[0]),children:[a.jsx(u,{className:"bg-transparent border-none text-white font-bold text-base w-full focus:ring-0 shadow-none",children:a.jsx(p,{})}),a.jsx(x,{className:"bg-slate-900 border-indigo-500/20 text-white font-bold",children:k.map(e=>a.jsx(_,{value:e.id,children:e.name},e.id))})]})]}),a.jsxs(h,{value:D.toString(),onValueChange:e=>$(parseInt(e)),children:[a.jsx(u,{className:"w-full md:w-44 bg-white/5 backdrop-blur-md border-white/10 text-white font-bold rounded-xl h-auto py-3",children:a.jsx(p,{})}),a.jsxs(x,{className:"bg-slate-900 border-indigo-500/20 text-white font-bold",children:[a.jsx(_,{value:"0",children:"Today"}),a.jsx(_,{value:"1",children:"Tomorrow"}),a.jsx(_,{value:"2",children:"2 Days Out"})]})]}),a.jsx(c,{onClick:J,disabled:e,className:"bg-indigo-500 hover:bg-indigo-400 text-white text-lg font-black px-8 py-3 h-auto rounded-xl shadow-lg shadow-indigo-500/20 active:translate-y-1 transition-all flex-none",children:e?a.jsx(m,{className:"animate-spin"}):"RUN MODEL"})]})}),C&&a.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-red-500/20 border border-red-500/40 rounded-xl p-6 text-center text-white font-bold mb-6",children:[a.jsx(o,{className:"w-8 h-8 mx-auto mb-2 text-red-300"}),C,a.jsx(c,{variant:"link",onClick:J,className:"text-white underline block mx-auto mt-2",children:"Try Again"})]}),a.jsx(l,{mode:"wait",children:r&&ee?a.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[a.jsxs("div",{className:`p-8 md:p-12 rounded-3xl bg-gradient-to-br ${ee.bgGradient} border border-white/20 shadow-2xl relative overflow-hidden`,children:[a.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-30 mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 text-center space-y-4",children:[r.stormRegimeFlag&&a.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-amber-500/20 border border-amber-400/30 rounded-full text-amber-300 text-xs font-bold mb-2",children:[a.jsx(o,{className:"w-3 h-3"}),"Weather models disagree significantly"]}),q&&q.hazard_level>0&&a.jsxs("div",{className:`inline-flex flex-col items-center gap-1 px-4 py-2 rounded-xl border font-bold text-xs ${["","text-sky-300 bg-sky-500/20 border-sky-400/30","text-amber-300 bg-amber-500/20 border-amber-400/30","text-red-300 bg-red-500/20 border-red-400/30","text-red-100 bg-red-700/40 border-red-400/50"][q.hazard_level]}`,children:[a.jsxs("span",{className:"text-[10px] uppercase tracking-widest opacity-70",children:["NWS ",["None","Advisory","Watch","Warning","Emergency"][q.hazard_level]," Â· ",q.forecast_office]}),q.hazard_codes.join(" Â· ")]}),(null==q?void 0:q.short_forecast)&&a.jsxs("div",{className:"text-sm text-white/50 italic",children:['"',q.short_forecast,'" â€” NWS ',q.forecast_office]}),a.jsxs("div",{className:"flex justify-center flex-wrap gap-2",children:[a.jsx("div",{className:`inline-block px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest border ${ee.badgeColor}`,children:r.chanceLabel}),"Minimal (<1)"!==r.stormStrength&&a.jsxs("div",{className:"inline-flex items-center gap-1.5 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest border bg-white/10 text-white border-white/20 backdrop-blur-sm",children:[a.jsx(v,{className:"w-3 h-3 text-blue-300"}),"Storm: ",r.stormStrength]})]}),a.jsx("div",{className:"text-7xl md:text-8xl",children:ee.icon}),a.jsx("h1",{className:`text-4xl md:text-6xl font-black tracking-tight leading-none ${ee.color}`,children:r.headline}),a.jsx("p",{className:"text-lg text-white/70 max-w-xl mx-auto",children:r.subtext}),"MODEL_DISAGREE"!==r.verdict&&a.jsx("div",{className:"mt-6 max-w-md mx-auto",children:a.jsx(T,{mean:r.meanProb,adjusted:r.adjustedProb,std:r.stdDev})})]})]}),L&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"text-[10px] uppercase font-bold text-white/30 tracking-widest",children:"3-Day Outlook"}),a.jsx(G,{forecasts:L})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{label:"Snow Forecast",value:`${r.metrics.snowfall_in}"`,icon:a.jsx(v,{className:"w-4 h-4 text-blue-300"})},{label:"Min Temp",value:`${r.metrics.min_temp_f}Â°F`,icon:a.jsx(j,{className:"w-4 h-4 text-cyan-300"})},{label:"Max Gust",value:`${r.metrics.max_gust_mph} mph`,icon:a.jsx(N,{className:"w-4 h-4 text-purple-300"})},{label:"Model Spread",value:`${r.metrics.model_spread_in}"`,icon:a.jsx(b,{className:"w-4 h-4 text-amber-300"})}].map(({label:e,value:t,icon:s})=>a.jsxs("div",{className:"bg-white/5 rounded-2xl p-4 border border-white/10 space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-white/40",children:[s," ",e]}),a.jsx("div",{className:"text-2xl font-black",children:t})]},e))}),a.jsxs("div",{className:"flex items-start gap-3 p-4 bg-black/20 rounded-xl border border-white/5",children:[a.jsx(w,{className:"w-5 h-5 text-indigo-400 flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"text-xs text-white/40",children:[a.jsx("span",{className:"text-white/60 font-bold",children:"Permutation baseline:"}),' Simply guessing "no closure" every day gives ',(100*U.permutationBaselineAccuracy).toFixed(1),"% accuracy for ",U.name," (snow days are rare). This model is calibrated to outperform that baseline on actual closure days."]})]}),a.jsxs("button",{onClick:()=>Y(!R),className:"w-full py-3 text-center text-white/20 hover:text-white/50 text-[10px] uppercase tracking-[0.2em] font-bold transition-all flex items-center justify-center gap-2",children:[R?a.jsx(f,{className:"w-3 h-3"}):a.jsx(g,{className:"w-3 h-3"}),R?"Hide Model Internals":"Show Model Internals"]}),a.jsx(l,{children:R&&a.jsx(z,{result:r})})]},"result"):!e&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-24 text-center text-white/30 space-y-4",children:[a.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center",children:a.jsx(d,{className:"w-8 h-8 opacity-50"})}),a.jsx("p",{className:"text-base font-medium max-w-xs mx-auto",children:"Configure district, then run the model."}),a.jsx("p",{className:"text-xs max-w-xs text-white/20",children:"XGBoost-analog Â· 50-pass Monte Carlo Â· Dynamic regional thresholds"})]})})]})]})};export{R as S};
