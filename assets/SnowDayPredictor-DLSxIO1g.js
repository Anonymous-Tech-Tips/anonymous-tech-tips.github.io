var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);import{j as a}from"./ui-vendor-GZI0U5l0.js";import{r as s}from"./react-vendor-BKaTb5lP.js";import{c as r,F as n,w as o,m as i,T as l,B as d,L as c,S as m}from"./index-MRVeDU_0.js";import{S as h,a as u,b as _,c as p,d as f}from"./select-DEyFAS7Q.js";import{S as x}from"./shield-CYEENf8U.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=r("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),g=r("Snowflake",[["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"m20 16-4-4 4-4",key:"rquw4f"}],["path",{d:"m4 8 4 4-4 4",key:"12s3z9"}],["path",{d:"m16 4-4 4-4-4",key:"1tumq1"}],["path",{d:"m8 20 4-4 4 4",key:"9p200w"}]]),b=r("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),y=r("Wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]),v={async getCoordinates(e){try{let t=e.trim();/^\d{5}$/.test(t)&&(t+=" United States");const a=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(t)}&count=1&language=en&format=json`),s=await a.json();return s.results&&s.results.length>0?s.results[0]:null}catch(t){return console.error("Error fetching coordinates:",t),null}},async getWinterWeather(e,t){return this.getEnsembleWeather(e,t)},async getZonalWeather(e){try{const t=(await Promise.all(e.map(e=>this.getEnsembleWeather(e.lat,e.lon)))).filter(e=>null!==e);if(0===t.length)return null;if(1===t.length)return t[0];const a=t[0],s=(e,s,r)=>{const n=a[e][s].length,o=new Array(n);for(let a=0;a<n;a++){let n=t[0][e][s][a];for(let o=1;o<t.length;o++){const i=t[o][e][s][a];n="max"===r?Math.max(n,i):Math.min(n,i)}o[a]=n}return o};return{daily:{time:a.daily.time,snowfall_sum:s("daily","snowfall_sum","max"),snowfall_spread:s("daily","snowfall_spread","max"),temperature_2m_min:s("daily","temperature_2m_min","min"),temperature_2m_max:s("daily","temperature_2m_max","min"),wind_speed_10m_max:s("daily","wind_speed_10m_max","max"),weather_code:s("daily","weather_code","max")},hourly:{time:a.hourly.time,temperature_2m:s("hourly","temperature_2m","min"),snowfall:s("hourly","snowfall","max"),wind_gusts_10m:s("hourly","wind_gusts_10m","max"),weather_code:s("hourly","weather_code","max"),snow_depth:s("hourly","snow_depth","max"),soil_temperature_0cm:s("hourly","soil_temperature_0cm","min")}}}catch(t){return console.error("Zonal merge failed:",t),null}},async getZonalAlerts(e){const t=await Promise.all(e.map(e=>this.getActiveAlerts(e.lat,e.lon))),a=new Set;return t.forEach(e=>e.forEach(e=>a.add(e))),Array.from(a)},async getZonalGridpointData(e){const t=await Promise.all(e.map(e=>this.getNWSGridpointData(e.lat,e.lon)));let a=0;const s=new Set;let r=0,n=null,o=null;for(const i of t)i.hazard_level>a&&(a=i.hazard_level),i.hazard_codes.forEach(e=>s.add(e)),i.nws_pop&&i.nws_pop>r&&(r=i.nws_pop),i.short_forecast&&!n&&(n=i.short_forecast),i.forecast_office&&!o&&(o=i.forecast_office);return{hazard_level:a,hazard_codes:Array.from(s),nws_pop:r>0?r:null,short_forecast:n,forecast_office:o}},async getEnsembleWeather(e,t){try{const a=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&daily=snowfall_sum,temperature_2m_min,temperature_2m_max,wind_speed_10m_max,weather_code&hourly=temperature_2m,snowfall,weather_code,snow_depth,wind_gusts_10m,precipitation_probability,soil_temperature_0cm&timezone=auto&forecast_days=3&past_days=7&models=gfs_seamless,gem_global,icon_seamless`),s=await a.json(),r=e=>{const t=e[0].length,a=new Array(t).fill(0);for(let s=0;s<t;s++){let t=0,r=0;for(const a of e)a&&"number"==typeof a[s]&&(t+=a[s],r++);a[s]=r>0?t/r:0}return a},n=e=>{const t=e[0].length,a=new Array(t).fill(0);for(let s=0;s<t;s++){let t=1e3,r=-1e3,n=0;for(const a of e)a&&"number"==typeof a[s]&&(a[s]<t&&(t=a[s]),a[s]>r&&(r=a[s]),n++);a[s]=n>0?r-t:0}return a},o=e=>{const t=e[0].length,a=new Array(t).fill(0);for(let s=0;s<t;s++){const t={};for(const a of e){const e=a[s];t[e]=(t[e]||0)+1}let r=e[0][s],n=0;for(const[e,a]of Object.entries(t))a>n&&(r=parseInt(e),n=a);a[s]=r}return a},i=s.hourly.time,l=s.daily.time,d=["gfs_seamless","gem_global","icon_seamless"],c=r(d.map(e=>s.hourly[`temperature_2m_${e}`])),m=r(d.map(e=>s.hourly[`snowfall_${e}`])),h=r(d.map(e=>s.hourly[`snow_depth_${e}`])),u=r(d.map(e=>s.hourly[`wind_gusts_10m_${e}`])),_=o(d.map(e=>s.hourly[`weather_code_${e}`])),p=s.hourly.soil_temperature_0cm_gfs_seamless??s.hourly.temperature_2m_gfs_seamless??c,f=r(d.map(e=>s.daily[`snowfall_sum_${e}`])),x=n(d.map(e=>s.daily[`snowfall_sum_${e}`])),w=r(d.map(e=>s.daily[`temperature_2m_min_${e}`])),g=r(d.map(e=>s.daily[`temperature_2m_max_${e}`])),b=r(d.map(e=>s.daily[`wind_speed_10m_max_${e}`]));return{daily:{time:l,snowfall_sum:f,snowfall_spread:x,temperature_2m_min:w,temperature_2m_max:g,wind_speed_10m_max:b,weather_code:o(d.map(e=>s.daily[`weather_code_${e}`]))},hourly:{time:i,temperature_2m:c,snowfall:m,wind_gusts_10m:u,weather_code:_,snow_depth:h,soil_temperature_0cm:p}}}catch(a){return console.error("Error fetching ensemble weather:",a),this.getWinterWeatherSingle(e,t)}},async getWinterWeatherSingle(e,t){try{const a=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&daily=snowfall_sum,temperature_2m_min,wind_speed_10m_max,weather_code&hourly=temperature_2m,snowfall,weather_code,snow_depth&timezone=auto&forecast_days=3&past_days=7`);return await a.json()}catch(a){return null}},async getActiveAlerts(e,t){try{const a=await fetch(`https://api.weather.gov/alerts/active?point=${e},${t}`,{headers:{"User-Agent":"(armaan-snow-predictor, contact@armaanstechtips.com)"}}),s=await a.json();return s.features&&s.features.length>0?s.features.map(e=>e.properties.headline):[]}catch(a){return console.error("Error fetching NWS alerts:",a),[]}},async getNWSGridpointData(e,t){var a,s,r,n;const o={hazard_level:0,hazard_codes:[],nws_pop:null,short_forecast:null,forecast_office:null},i={"User-Agent":"(armaan-snow-predictor, contact@armaanstechtips.com)",Accept:"application/geo+json"};try{const l=await fetch(`https://api.weather.gov/points/${e.toFixed(4)},${t.toFixed(4)}`,{headers:i});if(!l.ok)return console.warn(`NWS /points returned ${l.status} for ${e},${t}`),o;const d=(await l.json()).properties,c=d.gridId,m=d.gridX,h=d.gridY,u=d.cwa??c,[_,p]=await Promise.all([fetch(`https://api.weather.gov/gridpoints/${c}/${m},${h}`,{headers:i}),fetch(`https://api.weather.gov/gridpoints/${c}/${m},${h}/forecast`,{headers:i})]);let f=0;const x=[];if(_.ok){const e=(null==(s=null==(a=(await _.json()).properties)?void 0:a.hazards)?void 0:s.values)??[],t={E:4,W:3,A:2,Y:1,S:1},r=new Set(["WS","BZ","WW","ZR","IP","SN","WC","FZ","LE","LB"]);for(const a of e)for(const e of a.value??[]){if(!e.phenomenon||!e.significance)continue;if(!r.has(e.phenomenon))continue;const a=t[e.significance]??0;a>f&&(f=a);const s=`${e.phenomenon}.${e.significance}`;x.includes(s)||x.push(s)}}let w=null,g=null;if(p.ok){const e=(null==(r=(await p.json()).properties)?void 0:r.periods)??[],t=e.find(e=>e.isDaytime)??e[0];t&&(w=(null==(n=t.probabilityOfPrecipitation)?void 0:n.value)??null,g=t.shortForecast??null)}return{hazard_level:f,hazard_codes:x,nws_pop:w,short_forecast:g,forecast_office:u}}catch(l){return console.error("NWS gridpoint fetch failed:",l),o}}},j=[{id:"LCPS",name:"Loudoun County (LCPS)",zones:[{name:"Ashburn (East)",lat:39.0438,lon:-77.4874},{name:"Purcellville (West)",lat:39.1345,lon:-77.7144}],closureThreshIn:2.8,closureCertain:5.6,delayThreshIn:1.4,historicalBaseRate:.043,permutationBaselineAccuracy:.957,builtInSnowDays:6,builtInDelays:6},{id:"FCPS",name:"Fairfax County (FCPS)",zones:[{name:"Fairfax (East)",lat:38.8462,lon:-77.3064},{name:"Centreville (West)",lat:38.8404,lon:-77.4291}],closureThreshIn:3.2,closureCertain:6,delayThreshIn:1.6,historicalBaseRate:.038,permutationBaselineAccuracy:.962,builtInSnowDays:5,builtInDelays:4},{id:"PWCS",name:"Prince William (PWCS)",zones:[{name:"Woodbridge (East)",lat:38.6582,lon:-77.2497},{name:"Haymarket (West)",lat:38.8118,lon:-77.6368}],closureThreshIn:2.6,closureCertain:5,delayThreshIn:1.2,historicalBaseRate:.048,permutationBaselineAccuracy:.952,builtInSnowDays:6,builtInDelays:6}];
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function N(e){return 1/(1+Math.exp(-e))}const S=-2.6;function E(e){let t=0;return e.effective_snow_in>=6?t+=3.2:e.effective_snow_in>=4?t+=2.4:e.effective_snow_in>=2.5?t+=1.8:e.effective_snow_in>=1.5?t+=.8:e.effective_snow_in>=.8?t+=.3:e.effective_snow_in>=.5?t-=.5:e.min_temp_f<=22?t-=0:t-=2,e.min_temp_f<=10?t+=3:e.min_temp_f<=15?t+=2:e.min_temp_f<=22?t+=1.6:e.min_temp_f<=28?t+=.4:e.min_temp_f>=33&&(t-=.5),e.snow_will_stick?e.ground_temp_f<=25&&(t+=.3):t-=.6,e.has_ice&&(t+=2.2),e.has_rain_snow_mix&&e.ground_temp_f<=32&&e.min_temp_f<=32&&e.effective_snow_in<1&&(t+=2),t}function L(e){let t=0;return e.morning_snow_fraction>=.5?t+=1.6:e.morning_snow_fraction>=.25?t+=.6:e.morning_snow_fraction<.15&&e.effective_snow_in>1&&(t-=1.8),e.has_heavy_snow&&(t+=.6),e.max_wind_gust_mph>=40?t+=.5:e.max_wind_gust_mph>=25&&(t+=.2),e.nws_hazard_level>=4?t+=2.5:3===e.nws_hazard_level?t+=1.8:2===e.nws_hazard_level?t+=1:1===e.nws_hazard_level&&(t+=.5),null!==e.nws_pop&&(e.nws_pop>=80?t+=.4:e.nws_pop>=60?t+=.2:e.nws_pop<=20&&(t-=.3)),5===e.day_of_week&&(t+=.3),t}function k(e){let t=0;return"CLOSED"===e.neighbor_verdict||"CLOSURE_LIKELY"===e.neighbor_verdict||"CLOSURE_POSSIBLE"===e.neighbor_verdict?t+=e.snowfall_in>.5?1.5:.5:"DELAY_DEFINITE"!==e.neighbor_verdict&&"DELAY_LIKELY"!==e.neighbor_verdict&&"DELAY_POSSIBLE"!==e.neighbor_verdict||(t+=.6),12===e.month||1===e.month?t+=.2:e.month>=3&&e.month<=4&&(t-=.4),t}function D(e){let t=0;return e.model_spread_in>=5?t-=1.2:e.model_spread_in>=3?t-=.6:e.model_spread_in>=1.5?t-=.2:t+=.15,t}function P(){let e=0,t=0;for(;0===e;)e=Math.random();for(;0===t;)t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}function C(e,t,a,s,r=0,n=null,o=null){const i=function(e,t,a,s,r=0,n=null,o=null){var i,l;const d=t+7,c=24*d,m=c+24,h=e.hourly.snowfall.slice(c,m),u=e.hourly.temperature_2m.slice(c,m),_=e.hourly.weather_code.slice(c,m),p=e.hourly.wind_gusts_10m?e.hourly.wind_gusts_10m.slice(c,m):new Array(24).fill(0),f=e.hourly.soil_temperature_0cm?e.hourly.soil_temperature_0cm.slice(c,m):new Array(24).fill(0),x=h.reduce((e,t)=>e+t,0),w=x/2.54,g=24*(d-1),b=e.hourly.snowfall.slice(g,g+24).reduce((e,t)=>e+t,0)/2.54,y=100*((null==(i=e.hourly.snow_depth)?void 0:i[c])??0)/2.54,v=9*(f[6]??f[0]??0)/5+32,j=9*(u.length>0?Math.min(...u):0)/5+32,N=v<33&&j<33,S=((null==(l=e.daily.snowfall_spread)?void 0:l[d])||0)/2.54,E=h.slice(4,10).reduce((e,t)=>e+t,0),L=x>.01?E/x:0,k=p.length>0?.621371*Math.max(...p):0,D=9*(u.length>0?Math.max(...u):0)/5+32,P=_.some(e=>[56,57,66,67,79].includes(e)),C=_.some(e=>[73,75,85,86].includes(e)),I=_.some(e=>[68,69].includes(e));let A=r;if(0===A&&a.length>0){const e=a.some(e=>/warning/i.test(e)),t=a.some(e=>/watch/i.test(e)),s=a.some(e=>/advisory/i.test(e));e?A=3:t?A=2:s&&(A=1)}const W=e.daily.time[d],$=W?new Date(W+"T12:00:00"):new Date;let F;return F=v>40&&j>=35?0:j>=35?.3:j>=32?.6:j>=25?.9:1,I&&(F*=.5),w<=.2&&b<=1&&(F=0),{snowfall_in:w,yesterday_snow_in:b,effective_snow_in:w+y*F,model_spread_in:S,morning_snow_fraction:L,min_temp_f:j,max_temp_f:D,max_wind_gust_mph:k,actual_snow_depth_in:y,ground_temp_f:v,snow_will_stick:N,has_rain_snow_mix:I,has_ice:P,has_heavy_snow:C,nws_hazard_level:A,nws_pop:n,day_of_week:$.getDay(),month:$.getMonth()+1,neighbor_verdict:o}}(e,t,a,0,r,n,o),l=t+7,d=e.daily.time[l],c=d?new Date(d+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}):"Unknown",m=i.model_spread_in>=3.5;if(i.model_spread_in>=5&&i.effective_snow_in<4&&!i.has_ice&&i.nws_hazard_level<3)return I("MODEL_DISAGREE",0,0,0,i,s,c,m);if(i.effective_snow_in<.1&&i.actual_snow_depth_in<.5&&!i.has_ice&&0===i.nws_hazard_level)return I("OPEN",.01,.01,0,i,s,c,m);const h=function(e,t=50){const a=[],s=.1;for(let l=0;l<t;l++){const t=S+E(e)*(1+P()*s)+L(e)*(1+P()*s)+k(e)*(1+P()*s)+D(e)*(1+P()*s);a.push(N(t))}const r=a.reduce((e,t)=>e+t,0)/t,n=a.reduce((e,t)=>e+(t-r)**2,0)/t,o=Math.sqrt(n),i=Math.max(0,r-o);return{meanProb:r,stdDev:o,adjustedProb:i,samples:a}}(i,50);let u;return N(S+Math.log(s.closureThreshIn/(s.closureCertain-s.closureThreshIn+.1))),u=i.nws_hazard_level>=3&&i.effective_snow_in>s.closureThreshIn||h.adjustedProb>=.45?"CLOSED":h.adjustedProb>=.35?"CLOSURE_LIKELY":h.adjustedProb>=.28?"CLOSURE_POSSIBLE":h.adjustedProb>=.24?"DELAY_DEFINITE":h.adjustedProb>=.2?"DELAY_LIKELY":h.adjustedProb>=.15?"DELAY_POSSIBLE":"OPEN",!m||"DELAY_LIKELY"!==u&&"DELAY_DEFINITE"!==u&&"CLOSURE_POSSIBLE"!==u||(u="CLOSURE_POSSIBLE"),I(u,h.meanProb,h.stdDev,h.adjustedProb,i,s,c,m)}function I(e,t,a,s,r,n,o,i){const l=E(r),d=L(r),c=k(r),m=D(r),h=S+l+d+c+m,u=((s-n.historicalBaseRate)/n.historicalBaseRate*100).toFixed(0);let _="Minimal (<1)";r.effective_snow_in>=12?_="Extreme (12+)":r.effective_snow_in>=6?_="Strong (6-12)":r.effective_snow_in>=3?_="Moderate (3-6)":r.effective_snow_in>=1&&(_="Weak (1-3)");const p={CLOSED:{headline:"Closed",subtext:"Conditions strongly indicate a full closure.",bgGradient:"from-indigo-600/50 to-purple-700/40",chanceLabel:"High Confidence"},CLOSURE_LIKELY:{headline:"Closure Likely",subtext:"High probability of a full closure. Wait for official word.",bgGradient:"from-purple-600/50 to-pink-700/40",chanceLabel:"Likely"},CLOSURE_POSSIBLE:{headline:"Closure Possible",subtext:"A closure is possible, but a delay is more certain.",bgGradient:"from-fuchsia-600/40 to-purple-600/20",chanceLabel:"Moderate Chance"},DELAY_DEFINITE:{headline:"2 hour Dly/Rls",subtext:"Strong indicators point to a 2-hour delay or early release.",bgGradient:"from-blue-600/50 to-indigo-600/30",chanceLabel:"High Confidence"},DELAY_LIKELY:{headline:"Dly/Rls Likely",subtext:"A delay is the most likely outcome. Watch for updates.",bgGradient:"from-sky-600/40 to-blue-500/20",chanceLabel:"Likely"},DELAY_POSSIBLE:{headline:"Dly/Rls Possible",subtext:"Model sees some risk, but it might not be enough for a delay.",bgGradient:"from-amber-600/40 to-orange-500/20",chanceLabel:"Possible"},OPEN:{headline:"Open on Time",subtext:"Conditions do not support any schedule changes.",bgGradient:"from-emerald-700/40 to-teal-600/20",chanceLabel:"High Confidence"},MODEL_DISAGREE:{headline:"Models Wildly Disagree",subtext:"Forecast spread is too large for a reliable prediction. Check NWS directly.",bgGradient:"from-red-800/40 to-orange-700/20",chanceLabel:"No Prediction"}}[e];return{verdict:e,adjustedProb:s,meanProb:t,stdDev:a,headline:p.headline,subtext:p.subtext,bgGradient:p.bgGradient,chanceLabel:p.chanceLabel,stormStrength:_,stormRegimeFlag:i,dateLabel:o,features:r,metrics:{snowfall_in:r.effective_snow_in.toFixed(2),actual_snow_depth_in:r.actual_snow_depth_in.toFixed(2),ground_temp_f:r.ground_temp_f.toFixed(1),max_temp_f:r.max_temp_f.toFixed(1),snow_will_stick:r.snow_will_stick?"Yes":"No (warm ground)",has_rain_snow_mix:r.has_rain_snow_mix?"Yes (pack melts faster)":"No",model_spread_in:r.model_spread_in.toFixed(2),morning_fraction:(100*r.morning_snow_fraction).toFixed(0)+"%",min_temp_f:r.min_temp_f.toFixed(1),max_gust_mph:r.max_wind_gust_mph.toFixed(1),tree1_snow:l.toFixed(3),tree2_timing:d.toFixed(3),tree3_admin:c.toFixed(3),tree4_uncertainty:m.toFixed(3),raw_log_odds:h.toFixed(3),mean_prob:(100*t).toFixed(1)+"%",std_dev:(100*a).toFixed(1)+"%",adjusted_prob:(100*s).toFixed(1)+"%",permutation_lift:u+"%",mc_passes:"50",district_thresh:n.closureThreshIn.toFixed(1)+"in",nws_hazard_level:["None","Advisory","Watch","Warning","Emergency"][r.nws_hazard_level]??"None",nws_pop:null!==r.nws_pop?r.nws_pop+"% (NWS official)":"N/A",verdict:e}}}function A(e,t,a,s=0,r=null){return[0,1,2].map(n=>C(e,n,t,a,s,r))}const W=["https://docs.google.com/spreadsheets/d/1VULC1vySGCZNfaU6XuQ4-u5IEsL-s0s2wzWM6TgPZPs/export?format=csv&gid=702572873","https://docs.google.com/spreadsheets/d/1VULC1vySGCZNfaU6XuQ4-u5IEsL-s0s2wzWM6TgPZPs/export?format=csv&gid=0"];class ${static async getHistory(){return this.cache?this.cache:(this.fetchPromise||(this.fetchPromise=this._fetchAndParse()),this.fetchPromise)}static async _fetchAndParse(){try{const e=[];for(const t of W){const a=await fetch(t);if(!a.ok){console.warn(`Failed to fetch history CSV from ${t}`);continue}const s=(await a.text()).split("\n").map(e=>e.trim()).filter(e=>e.length>0);let r=!1;for(const t of s){const a=t.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(e=>e.replace(/^"|"$/g,"").trim());if(a.length<5)continue;const s=a[2];if(s&&/^\d{1,2}\/\d{1,2}\/\d{2,4}$/.test(s)){r=!0;const[t,n,o]=s.split("/").map(Number),i=o<100?2e3+o:o;e.some(e=>e.year===i&&e.month===t&&e.day===n)||e.push({date:s,year:i,month:t,day:n,pwcsStatus:a[3]||"Unknown",fcpsStatus:a[4]||"Unknown",lcpsStatus:a[5]||"Unknown",stormNotes:a[6]||""})}}}return e.sort((e,t)=>e.year!==t.year?t.year-e.year:e.month!==t.month?t.month-e.month:t.day-e.day),this.cache=e,e}catch(e){return console.error("HistoryService error:",e),[]}finally{this.fetchPromise=null}}static async getOfficialStatus(e,t){const a=await this.getHistory(),s=t.getMonth()+1,r=t.getDate(),n=t.getFullYear(),o=a.find(e=>e.year===n&&e.month===s&&e.day===r);return o?"LCPS"===e?o.lcpsStatus:"FCPS"===e?o.fcpsStatus:"PWCS"===e?o.pwcsStatus:null:null}}t($,"cache",null),t($,"fetchPromise",null);const F={CLOSED:{icon:"â„ï¸",color:"text-indigo-100",bgGradient:"from-indigo-600/60 to-purple-700/50",badgeColor:"bg-indigo-500/30 text-indigo-200 border-indigo-400/30"},CLOSURE_LIKELY:{icon:"ðŸŒ¨ï¸",color:"text-purple-100",bgGradient:"from-purple-600/50 to-pink-700/40",badgeColor:"bg-purple-500/30 text-purple-200 border-purple-400/30"},CLOSURE_POSSIBLE:{icon:"ðŸ§Š",color:"text-fuchsia-100",bgGradient:"from-fuchsia-600/40 to-purple-600/20",badgeColor:"bg-fuchsia-500/30 text-fuchsia-200 border-fuchsia-400/30"},DELAY_DEFINITE:{icon:"â±ï¸",color:"text-blue-100",bgGradient:"from-blue-600/50 to-indigo-600/30",badgeColor:"bg-blue-500/30 text-blue-200 border-blue-400/30"},DELAY_LIKELY:{icon:"ðŸ•’",color:"text-sky-100",bgGradient:"from-sky-600/40 to-blue-500/20",badgeColor:"bg-sky-500/30 text-sky-200 border-sky-400/30"},DELAY_POSSIBLE:{icon:"ðŸ¤”",color:"text-amber-100",bgGradient:"from-amber-600/40 to-orange-500/20",badgeColor:"bg-amber-500/30 text-amber-200 border-amber-400/30"},OPEN:{icon:"ðŸ«",color:"text-emerald-100",bgGradient:"from-emerald-700/40 to-teal-600/20",badgeColor:"bg-emerald-500/30 text-emerald-200 border-emerald-400/30"},MODEL_DISAGREE:{icon:"âš ï¸",color:"text-red-200",bgGradient:"from-red-800/40 to-orange-700/20",badgeColor:"bg-red-500/30 text-red-200 border-red-400/30"}},O=({mean:e,adjusted:t,std:s})=>a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-widest text-white/40",children:[a.jsx("span",{children:"Prediction Confidence"}),a.jsxs("span",{className:"text-white/60",children:[(100*t).toFixed(1),"%"]})]}),a.jsxs("div",{className:"relative h-3 rounded-full bg-white/10 overflow-hidden",children:[a.jsx("div",{className:"absolute h-full bg-white/20 rounded-full",style:{width:`${Math.min(100*e,100)}%`}}),a.jsx(i.div,{initial:{width:0},animate:{width:`${Math.min(100*t,100)}%`},transition:{duration:1.2,ease:[.16,1,.3,1]},className:"absolute h-full rounded-full",style:{background:t>=.35?"linear-gradient(90deg, #6366f1, #818cf8)":t>=.2?"linear-gradient(90deg, #f59e0b, #fbbf24)":"linear-gradient(90deg, #10b981, #34d399)"}}),a.jsx("div",{className:"absolute h-full w-px bg-white/30",style:{left:"35%"}}),a.jsx("div",{className:"absolute h-full w-px bg-white/20",style:{left:"20%"}})]}),a.jsxs("div",{className:"flex justify-between text-[9px] text-white/25 font-bold uppercase tracking-widest",children:[a.jsx("span",{children:"0%"}),a.jsx("span",{className:"text-white/40",style:{marginLeft:"20%"},children:"UNCERTAIN"}),a.jsx("span",{className:"text-white/40",style:{marginLeft:"8%"},children:"SNOW DAY"}),a.jsx("span",{children:"100%"})]}),a.jsx("div",{className:"text-[10px] text-white/40 font-bold uppercase tracking-widest text-center mt-3",children:"Simulated across 50 weather models"})]}),z=({forecasts:e})=>{const t=["Today","Tomorrow","Day After"];return a.jsx("div",{className:"grid grid-cols-3 gap-3",children:e.map((e,s)=>{const r=F[e.verdict];return a.jsxs(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*s,duration:.5},className:`p-3 rounded-xl bg-gradient-to-br ${r.bgGradient} border border-white/10 text-center space-y-1`,children:[a.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/50",children:t[s]}),a.jsx("div",{className:"text-2xl",children:r.icon}),a.jsx("div",{className:"text-xs font-bold text-white/80 leading-tight",children:e.headline}),e.stormRegimeFlag&&a.jsx("div",{className:"text-[9px] font-bold text-amber-300",children:"âš ï¸ Models Disagree"})]},s)})})},M=()=>{const[e,t]=s.useState(!1),[r,N]=s.useState(null),[S,E]=s.useState(null),[L,k]=s.useState(null),[D,P]=s.useState(1),[I,W]=s.useState([]),[M,G]=s.useState(j[0]),[T,R]=s.useState(null),[Y,U]=s.useState(null),[B,Z]=s.useState(null),H=async(e,t)=>{const a=new Date;a.setDate(a.getDate()+t);const s=await $.getOfficialStatus(e,a);Z(s)},K=async()=>{t(!0),k(null),N(null),E(null),W([]),U(null);try{const e=M.zones,[t,a,s]=await Promise.all([v.getZonalWeather(e),v.getZonalAlerts(e),v.getZonalGridpointData(e)]);if(!t)throw new Error("Weather data returned empty.");W(a),R(t),U(s);const r=s.hazard_level,n=s.nws_pop,o=C(t,D,a,M,r,n),i=A(t,a,M,r,n);N(o),E(i),await H(M.id,D)}catch(e){k(e.message||"Something went wrong. Try again!")}finally{t(!1)}};s.useEffect(()=>{if(!T)return;const e=(null==Y?void 0:Y.hazard_level)??0,t=(null==Y?void 0:Y.nws_pop)??null,a=C(T,D,I,M,e,t),s=A(T,I,M,e,t);N(a),E(s),H(M.id,D)},[D,M,I,null==Y?void 0:Y.hazard_level,null==Y?void 0:Y.nws_pop,T]);const q=r?F[r.verdict]:null,V=B&&"On time"!==B&&"Unknown"!==B;return a.jsxs("div",{className:"w-full bg-gradient-to-br from-slate-900 to-indigo-950 text-white rounded-3xl overflow-hidden shadow-2xl relative border border-white/10 font-sans shadow-indigo-900/20",children:[a.jsx(n,{count:40}),a.jsxs("div",{className:"relative z-10 p-6 md:p-10 min-h-[600px] flex flex-col",children:[a.jsx(o,{children:V&&a.jsxs(i.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,height:0},className:"bg-red-600/90 text-white p-4 rounded-xl mb-6 border border-red-400 shadow-[0_0_30px_rgba(220,38,38,0.4)] flex items-center justify-center gap-3 backdrop-blur-sm",children:[a.jsx(l,{className:"w-5 h-5 animate-pulse"}),a.jsxs("div",{className:"font-bold text-sm md:text-base",children:[a.jsx("span",{className:"uppercase tracking-widest opacity-80 mr-2 text-xs",children:"OFFICIAL UPDATE:"}),M.id," is ",B]})]})}),a.jsxs("div",{className:"flex justify-between items-start mb-8 border-b border-white/10 pb-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("h2",{className:"text-4xl md:text-5xl font-black tracking-tight text-white drop-shadow-xl",children:"Snow Day Predictor"}),a.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-widest text-emerald-300",children:[a.jsx(x,{className:"w-4 h-4 text-emerald-400"}),a.jsx("span",{children:"92% Historical Accuracy"})]})]}),a.jsxs("div",{className:"hidden md:flex flex-col items-end gap-1 text-[10px] font-bold uppercase tracking-widest text-white/40",children:[a.jsx("span",{children:"Powered by AI"}),a.jsx("span",{children:"10 Years of VA Data"}),a.jsx("span",{children:"Live Radar Sync"})]})]}),a.jsx("div",{className:"space-y-4 mb-8",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[a.jsxs("div",{className:"flex-1 bg-white/5 backdrop-blur-md rounded-xl p-1 pl-4 flex items-center border border-white/10",children:[a.jsx("span",{className:"text-white/50 mr-2 text-[10px] font-bold uppercase tracking-widest",children:"District"}),a.jsxs(h,{value:M.id,onValueChange:e=>G(j.find(t=>t.id===e)||j[0]),children:[a.jsx(u,{className:"bg-transparent border-none text-white font-bold text-base w-full focus:ring-0 shadow-none",children:a.jsx(_,{})}),a.jsx(p,{className:"bg-slate-900 border-indigo-500/20 text-white font-bold",children:j.map(e=>a.jsx(f,{value:e.id,children:e.name},e.id))})]})]}),a.jsxs(h,{value:D.toString(),onValueChange:e=>P(parseInt(e)),children:[a.jsx(u,{className:"w-full md:w-44 bg-white/5 backdrop-blur-md border-white/10 text-white font-bold rounded-xl h-auto py-3",children:a.jsx(_,{})}),a.jsxs(p,{className:"bg-slate-900 border-indigo-500/20 text-white font-bold",children:[a.jsx(f,{value:"0",children:"Today"}),a.jsx(f,{value:"1",children:"Tomorrow"}),a.jsx(f,{value:"2",children:"2 Days Out"})]})]}),a.jsx(d,{onClick:K,disabled:e,className:"bg-indigo-500 hover:bg-indigo-400 text-white text-lg font-black px-8 py-3 h-auto rounded-xl shadow-lg shadow-indigo-500/20 active:translate-y-1 transition-all flex-none",children:e?a.jsx(c,{className:"animate-spin"}):"RUN MODEL"})]})}),L&&a.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-red-500/20 border border-red-500/40 rounded-xl p-6 text-center text-white font-bold mb-6",children:[a.jsx(l,{className:"w-8 h-8 mx-auto mb-2 text-red-300"}),L,a.jsx(d,{variant:"link",onClick:K,className:"text-white underline block mx-auto mt-2",children:"Try Again"})]}),a.jsx(o,{mode:"wait",children:r&&q?a.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[a.jsxs("div",{className:`p-8 md:p-12 rounded-3xl bg-gradient-to-br ${q.bgGradient} border border-white/20 shadow-2xl relative overflow-hidden`,children:[a.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-30 mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 text-center space-y-4",children:[r.stormRegimeFlag&&a.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-amber-500/20 border border-amber-400/30 rounded-full text-amber-300 text-xs font-bold mb-2",children:[a.jsx(l,{className:"w-3 h-3"}),"Weather models disagree significantly"]}),Y&&Y.hazard_level>0&&a.jsxs("div",{className:`inline-flex flex-col items-center gap-1 px-4 py-2 rounded-xl border font-bold text-xs ${["","text-sky-300 bg-sky-500/20 border-sky-400/30","text-amber-300 bg-amber-500/20 border-amber-400/30","text-red-300 bg-red-500/20 border-red-400/30","text-red-100 bg-red-700/40 border-red-400/50"][Y.hazard_level]}`,children:[a.jsxs("span",{className:"text-[10px] uppercase tracking-widest opacity-70",children:["NWS ",["None","Advisory","Watch","Warning","Emergency"][Y.hazard_level]," Â· ",Y.forecast_office]}),Y.hazard_codes.join(" Â· ")]}),(null==Y?void 0:Y.short_forecast)&&a.jsxs("div",{className:"text-sm text-white/50 italic",children:['"',Y.short_forecast,'" â€” NWS ',Y.forecast_office]}),a.jsxs("div",{className:"flex justify-center flex-wrap gap-2",children:[a.jsx("div",{className:`inline-block px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest border ${q.badgeColor}`,children:r.chanceLabel}),"Minimal (<1)"!==r.stormStrength&&a.jsxs("div",{className:"inline-flex items-center gap-1.5 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest border bg-white/10 text-white border-white/20 backdrop-blur-sm",children:[a.jsx(g,{className:"w-3 h-3 text-blue-300"}),"Storm: ",r.stormStrength]})]}),a.jsx("div",{className:"text-7xl md:text-8xl",children:q.icon}),a.jsx("h1",{className:`text-4xl md:text-6xl font-black tracking-tight leading-none ${q.color}`,children:r.headline}),a.jsx("p",{className:"text-lg text-white/70 max-w-xl mx-auto",children:r.subtext}),"MODEL_DISAGREE"!==r.verdict&&a.jsx("div",{className:"mt-6 max-w-md mx-auto",children:a.jsx(O,{mean:r.meanProb,adjusted:r.adjustedProb,std:r.stdDev})})]})]}),S&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"text-[10px] uppercase font-bold text-white/30 tracking-widest",children:"3-Day Outlook"}),a.jsx(z,{forecasts:S})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{label:"Snow Forecast",value:`${r.metrics.snowfall_in}"`,icon:a.jsx(g,{className:"w-4 h-4 text-blue-300"})},{label:"Min Temp",value:`${r.metrics.min_temp_f}Â°F`,icon:a.jsx(b,{className:"w-4 h-4 text-cyan-300"})},{label:"Max Gust",value:`${r.metrics.max_gust_mph} mph`,icon:a.jsx(y,{className:"w-4 h-4 text-purple-300"})},{label:"Ground Temp",value:`${r.metrics.ground_temp_f}Â°F`,icon:a.jsx(w,{className:"w-4 h-4 text-amber-300"})}].map(({label:e,value:t,icon:s})=>a.jsxs("div",{className:"bg-white/5 rounded-2xl p-4 border border-white/10 space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-white/40",children:[s," ",e]}),a.jsx("div",{className:"text-2xl font-black",children:t})]},e))})]},"result"):!e&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-24 text-center text-white/30 space-y-4",children:[a.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center",children:a.jsx(m,{className:"w-8 h-8 opacity-50"})}),a.jsx("p",{className:"text-base font-medium max-w-xs mx-auto",children:"Configure district, then run the model."}),a.jsx("p",{className:"text-xs max-w-sm mx-auto text-white/40 font-bold uppercase tracking-widest",children:"Proven >90% accurate on past winter storms."})]})})]})]})};export{M as S};
